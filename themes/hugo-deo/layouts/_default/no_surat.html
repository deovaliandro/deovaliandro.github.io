{{- partial "header.html" . -}}

<h2>Pembuat Nomor Surat Otomatis</h2>

<div class="toggle-switch">
    <strong>Pilih Skema Penomoran:</strong>
    <div>
        <button id="btnOrganisasi" class="active">Skema Organisasi (AM)</button>
        <button id="btnPanitia">Skema Panitia/Tim</button>
    </div>
</div>

<div class="form-group">
    <label for="nomorSurat">1. Nomor Urut Surat (3 Digit)</label>
    <input type="number" id="nomorSurat" value="1" min="1" max="999" oninput="updateNomorSurat()">
</div>

<div id="organisasiForm">
    <h3>Input Skema Organisasi</h3>
    <div class="form-group">
        <label for="amKe">2. Nomor Pertemuan AM ke- (XII)</label>
        <input type="number" id="amKe" value="12" min="1" max="12" oninput="updateNomorSurat()">
    </div>
    <div class="form-group">
        <label for="indeksUtama">3. Indeks Utama (Contoh: VII)</label>
        <select id="indeksUtama" onchange="populateIndeksSub(); updateNomorSurat();"></select>
    </div>
    <div class="form-group">
        <label for="indeksSub">4. Indeks Sub (Contoh: 05)</label>
        <select id="indeksSub" onchange="updateNomorSurat();"></select>
    </div>
    <div class="form-group">
        <label for="lingkupOrganisasi">5. Kode Pengurus Organisasi (Contoh: PJ)</label>
        <select id="lingkupOrganisasi" onchange="updateNomorSurat()">
            <option value="PS">PS (Pengurus Sinode)</option>
            <option value="PK">PK (Pengurus Klasis)</option>
            <option value="PJ">PJ (Pengurus Jemaat)</option>
        </select>
    </div>
    <div class="form-group">
        <label for="singkatanNamaOrganisasi">6. Singkatan Nama Klasis/Jemaat (Contoh: JEL)</label>
        <input type="text" id="singkatanNamaOrganisasi" value="JEL"
            oninput="this.value = this.value.toUpperCase(); updateNomorSurat()">
    </div>
</div>

<div id="panitiaForm" style="display:none;">
    <h3>Input Skema Panitia/Tim</h3>
    <div class="form-group">
        <label for="kodePanitia">2. Kode Panitia/Tim Kerja (PAN atau TK)</label>
        <select id="kodePanitia" onchange="updateNomorSurat()">
            <option value="PAN">PAN (Panitia)</option>
            <option value="TK">TK (Tim Kerja)</option>
        </select>
    </div>
    <div class="form-group">
        <label for="singkatanKegiatan">3. Singkatan Kegiatan Panitia (Contoh: NATAL)</label>
        <input type="text" id="singkatanKegiatan" value="NATAL"
            oninput="this.value = this.value.toUpperCase(); updateNomorSurat()">
    </div>
    <div class="form-group">
        <label for="lingkupPanitia">4. Singkatan Nama Kepengurusan (Klasis/Jemaat) - (Contoh: KPLW)</label>
        <input type="text" id="lingkupPanitia" value="KPLW"
            oninput="this.value = this.value.toUpperCase(); updateNomorSurat()">
    </div>
</div>

<div class="form-group">
    <label id="labelBulan" for="bulan"> Bulan (2 Digit)</label>
    <input type="number" id="bulan" min="1" max="12" oninput="updateNomorSurat()">
</div>

<div class="form-group">
    <label id="labelTahun" for="tahun"> Tahun</label>
    <input type="number" id="tahun" min="2000" max="2100" oninput="updateNomorSurat()">
</div>

<div class="result-container">
    <h3>✅ Nomor Surat yang Dihasilkan:</h3>
    <p id="resultNumber">XII.001.I-01.PJ-PPGTM.JEL.11.2025</p>
</div>

<div class="info-box">
    <div id="penjelasanFormat"></div>
</div>

<script>
    // --- DATA INDEKS ---
    const dataIndex = {
        'I. HUBUNGAN DENGAN GEREJA & BADAN ORGANISASI DALAM & LUAR NEGERI': [
            "1. ZCGK DI BELANDA",
            "2. DEPUTATEN BANTUAN DI BELANDA",
            "3. EMS DI JERMAN",
            "4. GEREJA-GEREJA DI LUAR NEGERI",
            "5. ORGANISASI/LEMBAGA LUAR NEGERI YANG BERGERAK DI BIDANG PELAYANAN GEREJA DAN DIAKONIA",
            "6. WORLD COMMUNION OF REFORMED CHURCHES (WARC)",
            "7. CHURCH WORLD SERVIS (CWS)",
            "8. WYCLIFF",
            "9. LANGHAM",
            "10. LEMBAGA PELAYANAN MAHASISWA INDONESIA",
            "11. INSTITUT LEIMENA",
            "12. LEMBAGA ALKITAB INDONESIA",
            "13. THE GIDEON",
            "14. DAN LAIN-LAIN"
        ],
        'II. HUBUNGAN DENGAN GEREJA DALAM NEGERI': [
            "1. MPH - PGI",
            "2. MARTURIA PGI",
            "3. DIAKONIA PGI",
            "4. KOINONIA PGI",
            "5. MPPK",
            "6. BALITBANG PGI",
            "7. BIRO HUKUM PGI",
            "8. YAKOMA-PGI",
            "9. BIRO PEREMPUAN DAN ANAK",
            "10. BIRO PEMUDA",
            "11. DANA PENSIUN",
            "12. BPP - PGI",
            "13. PELKESI",
            "14. POUK",
            "15. YAMUGER",
            "16. MPH - PGIW SULSELBARA",
            "17. BIRO PEREMPUAN & ANAK PGIW",
            "18. BIRO PEMUDA PGIW",
            "19. BIRO HUKUM PGIW",
            "20. PGIW / SAG",
            "21. GEREJA ANGGOTA PGI",
            "22. GEREJA NON ANGGOTA PGI",
            "23. FKUB",
            "24. BAMAG",
            "25. DAN LAIN-LAIN"
        ],
        'III. HUBUNGAN DENGAN PEMERINTAH': [
            "1. PRESIDEN R.I.",
            "2. WAKIL PRESEDEN RI",
            "3. KPK",
            "4. DPR/MPR/MA/MK/DPD",
            "5. KEMENTRIAN R.I",
            "6. SEKJEN/DIRJEN/IRJEN",
            "7. GUBERNUR",
            "8. SETDA/DINAS/KA. KANTOR PROPINSI",
            "9. BUPATI",
            "10. SETDA/DINAS/KA. KANTOR KABUPATEN",
            "11. KOMISI PEMILIHAN UMUM (KPU)",
            "12. PANWASLU",
            "13. CAMAT",
            "14. KA. DESA / LURAH",
            "15. KA. DUSUN",
            "16. BUMN/BUMD",
            "17. PARTAI POLITIK",
            "18. DAN LAIN-LAIN"
        ],
        'IV. HUBUNGAN DENGAN KEAMANAN': [
            "1. PANGLIMA TNI",
            "2. KAPOLRI",
            "3. KASAD/KASAU/KASAL",
            "4. KODAM",
            "5. POLDA",
            "6. KOREM",
            "7. POLWIL",
            "8. KODIM",
            "9. POLRES",
            "10. KORAMIL",
            "11. POLSEK",
            "12. DAN LAIN-LAIN"
        ],
        'V. HUBUNGAN DENGAN PENDIDIKAN': [
            "1. PERGURUAN TINGGI NEGERI",
            "2. PERGURUAN TINGGI SWASTA",
            "3. SEKOLAH TINGGI THEOLOGIA",
            "4. SMA",
            "5. SMK",
            "6. SLTP",
            "7. SD",
            "8. PAUD",
            "9. ORGANISASI MAHASISWA / SISWA",
            "10. LEMBAGA YANG MENYELENGGARAKAN KURSUS",
            "11. DAN LAIN-LAIN"
        ],
        'VI. HUBUNGAN DENGAN LEMBAGA LINGKUP SINODE - GTM': [
            "1. BPMS - GTM",
            "2. MPS GTM",
            "3. BPPS - GTM",
            "4. PPr-GTM",
            "5. PP-GTM",
            "6. PKB-GTM",
            "7. PAR-GTM",
            "8. BIRO HUKUM",
            "9. BIDANG-BIDANG",
            "10. YAYASAN GTM",
            "11. PANITIA/TIM",
            "12. PENERJEMAHAN ALKITAB BAHASA DAERAH",
            "13. DAN LAIN-LAIN"
        ],
        'VII. HUBUNGAN DENGAN LEMBAGA LINGKUP KLASIS': [
            "1. BPMK",
            "2. MPK",
            "3. BPPK",
            "4. PPr-GTM",
            "5. PP-GTM",
            "6. PKB GTM",
            "7. PAR GTM",
            "8. BIDANG-BIDANG",
            "9. REKOMENDASI/TUGAS/KETERANGAN",
            "10. PANITIA/TIM",
            "11. DAN LAIN-LAIN"
        ],
        'VIII. HUBUNGAN DENGAN LEMBAGA LINGKUP JEMAAT': [
            "1. BPPJ",
            "2. MPJ",
            "3. PPr GTM",
            "4. PPGTM",
            "5. PKB GTM",
            "6. PAR GTM",
            "7. PANITIA/TIM",
            "8. KETERANGAN/REKOMENDASI",
            "9. DAN LAIN-LAIN"
        ],
        'IX. HUBUNGAN DENGAN PELAYAN GEREJA': [
            "1. PENDETA",
            "2. PENATUA",
            "3. DIAKEN",
            "4. TENAGA VICARIS/PKL/KKL",
            "5. GURU SEKOLAH MINGGU",
            "6. GURU REMAJA",
            "7. GURU KATEKISASI",
            "8. KELUARGA PENDETA",
            "9. PEGAWAI GEREJA/KOSTER",
            "10. DAN LAIN-LAIN"
        ]
    };

    const roman = ["", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X", "XI", "XII"];

    // --- HELPER FUNCTIONS ---
    function toRoman(num) {
        const val = parseInt(num);
        if (isNaN(val) || val < 1 || val > 12) return '';
        return roman[val];
    }

    function padNumber(num, length = 3) {
        return String(num).padStart(length, '0');
    }

    // --- VIEW CONTROLLERS ---
    function setupInitialValues() {
        const today = new Date();
        document.getElementById('bulan').value = padNumber(today.getMonth() + 1, 2);
        document.getElementById('tahun').value = today.getFullYear();
        document.getElementById('lingkupOrganisasi').value = 'PJ'; // Default PJ
        document.getElementById('indeksUtama').value = 'I'; // Default I
    }

    function populateIndeksUtama() {
        const select = document.getElementById('indeksUtama');
        select.innerHTML = '';
        const keys = Object.keys(dataIndex);

        keys.forEach(key => {
            const match = key.match(/^(\w+)/);
            const code = match ? match[1] : key;
            const description = key.split('. ')[1];

            const option = document.createElement('option');
            option.value = code;
            option.textContent = `${code} - ${description}`;
            select.appendChild(option);
        });

        populateIndeksSub();
    }

    function populateIndeksSub() {
        const selectUtama = document.getElementById('indeksUtama');
        const selectSub = document.getElementById('indeksSub');
        selectSub.innerHTML = '';

        const selectedCode = selectUtama.value;
        const currentIndeksUtama = Object.keys(dataIndex).find(key => key.startsWith(selectedCode + '.'));

        if (currentIndeksUtama && dataIndex[currentIndeksUtama]) {
            dataIndex[currentIndeksUtama].forEach(item => {
                const [numStr, ...descParts] = item.split('.');
                const num = numStr.trim().padStart(2, '0');

                const option = document.createElement('option');
                option.value = num;
                option.textContent = `${num} - ${descParts.join('.').trim()}`;
                selectSub.appendChild(option);
            });
        }
    }

    function toggleMode(isPanitia) {
        const btnOrganisasi = document.getElementById('btnOrganisasi');
        const btnPanitia = document.getElementById('btnPanitia');
        const organisasiForm = document.getElementById('organisasiForm');
        const panitiaForm = document.getElementById('panitiaForm');

        if (isPanitia) {
            btnPanitia.classList.add('active');
            btnOrganisasi.classList.remove('active');
            organisasiForm.style.display = 'none';
            panitiaForm.style.display = 'block';
            document.getElementById('labelBulan').textContent = '5. Bulan (2 Digit)';
            document.getElementById('labelTahun').textContent = '6. Tahun';
        } else {
            btnOrganisasi.classList.add('active');
            btnPanitia.classList.remove('active');
            panitiaForm.style.display = 'none';
            organisasiForm.style.display = 'block';
            document.getElementById('labelBulan').textContent = '7. Bulan (2 Digit)';
            document.getElementById('labelTahun').textContent = '8. Tahun';
        }
        updateNomorSurat();
    }

    // --- GENERATOR LOGIC ---
    function getNomorSuratOrganisasi() {
        const amKe = document.getElementById('amKe').value;
        const nomorSurat = padNumber(document.getElementById('nomorSurat').value);
        const indeksUtama = document.getElementById('indeksUtama').value;
        const indeksSub = document.getElementById('indeksSub').value;
        const lingkupOrganisasi = document.getElementById('lingkupOrganisasi').value;
        const singkatanNamaOrganisasi = document.getElementById('singkatanNamaOrganisasi').value;
        const bulan = padNumber(document.getElementById('bulan').value, 2);
        const tahun = document.getElementById('tahun').value;

        const formattedAmKe = toRoman(amKe);
        const formattedIndeks = `${indeksUtama}-${indeksSub}`;
        const formattedPengurus = `${lingkupOrganisasi}-PPGTM`;

        return [
            formattedAmKe,
            nomorSurat,
            formattedIndeks,
            formattedPengurus,
            singkatanNamaOrganisasi,
            bulan,
            tahun
        ].filter(Boolean).join('.');
    }

    function getNomorSuratPanitia() {
        const nomorSurat = padNumber(document.getElementById('nomorSurat').value);
        const kodePanitia = document.getElementById('kodePanitia').value;
        const singkatanKegiatan = document.getElementById('singkatanKegiatan').value;
        const lingkupPanitia = document.getElementById('lingkupPanitia').value;
        const bulan = padNumber(document.getElementById('bulan').value, 2);
        const tahun = document.getElementById('tahun').value;

        const formattedPanitia = `${kodePanitia}-${singkatanKegiatan}`;
        const formattedPengurus = `PPGTM-${lingkupPanitia}`;

        return [
            nomorSurat,
            formattedPanitia,
            formattedPengurus,
            bulan,
            tahun
        ].filter(Boolean).join('.');
    }

    function updatePenjelasan(isPanitia) {
        const explanationDiv = document.getElementById('penjelasanFormat');

        if (isPanitia) {
            explanationDiv.innerHTML = `
                <h4>ℹ️ Penjelasan Format Panitia/Tim:</h4>
                <p><strong>${padNumber(document.getElementById('nomorSurat').value)}</strong>: Nomor Urut Surat (3 Digit)</p>
                <p><strong>${document.getElementById('kodePanitia').value}-${document.getElementById('singkatanKegiatan').value}</strong>: Kode Panitia/Tim Kerja (misalnya PAN-NATAL)</p>
                <p><strong>PPGTM-${document.getElementById('lingkupPanitia').value}</strong>: PPGTM lalu Kode Klasis/Jemaat/Kepengurusan (misalnya PPGTM-KPLW)</p>
                <p><strong>${padNumber(document.getElementById('bulan').value, 2)}</strong>: Bulan (MM)</p>
                <p><strong>${document.getElementById('tahun').value}</strong>: Tahun (YYYY)</p>
            `;
        } else {
            const amKe = document.getElementById('amKe').value;
            const formattedAmKe = toRoman(amKe);
            const formattedIndeks = `${document.getElementById('indeksUtama').value}-${document.getElementById('indeksSub').value}`;
            const formattedPengurus = `${document.getElementById('lingkupOrganisasi').value}-PPGTM`;

            explanationDiv.innerHTML = `
                <h4>ℹ️ Penjelasan Format Organisasi (AM):</h4>
                <p><strong>${formattedAmKe}</strong>: Pertemuan AM</p>
                <p><strong>${padNumber(document.getElementById('nomorSurat').value)}</strong>: Nomor Urut Surat</p>
                <p><strong>${formattedIndeks}</strong>: Indeks (Utama-Sub)</p>
                <p><strong>${formattedPengurus}</strong>: Kode Pengurus (PS/PK/PJ) + PPGTM</p>
                <p><strong>${document.getElementById('singkatanNamaOrganisasi').value}</strong>: Singkatan Nama Klasis/Jemaat</p>
                <p><strong>${padNumber(document.getElementById('bulan').value, 2)}</strong>: Bulan (MM)</p>
                <p><strong>${document.getElementById('tahun').value}</strong>: Tahun (YYYY)</p>
            `;
        }
    }

    function updateNomorSurat() {
        const isPanitia = document.getElementById('panitiaForm').style.display !== 'none';
        let result;

        if (isPanitia) {
            result = getNomorSuratPanitia();
        } else {
            result = getNomorSuratOrganisasi();
        }

        document.getElementById('resultNumber').textContent = result;
        updatePenjelasan(isPanitia);
    }

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        setupInitialValues();
        populateIndeksUtama();

        // Setup Event Listeners untuk Toggle
        document.getElementById('btnOrganisasi').addEventListener('click', () => toggleMode(false));
        document.getElementById('btnPanitia').addEventListener('click', () => toggleMode(true));

        // Setup Event Listeners untuk input number/text/select (di HTML sudah pakai oninput/onchange)
        // Kita panggil updateNomorSurat() sekali di awal untuk inisiasi hasil
        updateNomorSurat();
    });
</script>

{{- partial "footer.html" . -}}